<!DOCTYPE HTML>
<!-- ************************************* -->
<!-- *          VY THUY NGUYEN           * -->
<!-- * CSE-6242: Homework 2 - Question 5 * -->
<!-- ************************************* -->
<html>
	<head>
		<meta charset="utf-8">
		<title>Q7</title>
		<style>
		.state-boundary 
		{
		  fill: none;
		  stroke: #777;
		  stroke-dasharray: 2,2;
		  stroke-linejoin: round;
		}
		</style>
		
		<script type="text/javascript" src="../lib/d3.v3.min.js"></script>
		<script type="text/javascript" src="../lib/d3-queue.v3.min.js"></script>
		<script type="text/javascript" src="../lib/topojson.v1.min.js"></script>
	</head>
	<body>
		<svg width="960" height="600"></svg>
	
	<script>		
		var svg = d3.select("svg"),
	    width = +svg.attr("width"),
	    height = +svg.attr("height");
		
		var medIncome = d3.map();
		 d3.queue()
			.defer(d3.json, "us.json")
			.defer(d3.json, "median_earnings.json")
			.awaitAll(function (error, data) 
			{ 
				if (error)
					return console.log("Error loading data. Bye!!!");
				
				var us = data[0];
				var incomes = data[1];
				
				//Process income data
				var minIncome = -1, maxIncome = -1;
				incomes.map(function (income) {
					var inc = +income.median_earnings;
					
					if (minIncome < 0 || inc < minIncome)
						minIncome = inc;
					if (maxIncome < 0 || inc > maxIncome)
						maxIncome = inc;
					
					medIncome.set(income.id, inc);
				});
				
				//Chart stuff
				var states = topojson.feature(us, us.objects.states).features;
				var projection = d3.geo.mercator();
				var path = d3.geo.path().projection (projection);
				
				//Color scale
				var color = d3.scale.linear()
								.domain([minIncome, maxIncome])
								.range(["white", "green"]);
				
				svg.selectAll(".state")
						.data(states)
						.enter()
						.append("path")
						.attr("class", function (d) {
							return "state " + d.id;
						})
						.attr("fill", function (d) {
							return color(medIncome.get(d.id));
						})
						.attr("d", path);
			 });
		
		
	
		
	</script>
	
	</body>
</html>